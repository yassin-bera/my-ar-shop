<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AR Gallery Ultra</title>
    
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js?v=2"></script>

    <style>
        :root {
            --primary: #00b894; --surface: rgba(255, 255, 255, 0.95);
            --font-fa: 'Vazirmatn', sans-serif; --font-en: -apple-system, sans-serif;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { margin: 0; height: 100dvh; width: 100vw; overflow: hidden; font-family: var(--font-fa); background-color: #b2bec3; }
        body.lang-en { font-family: var(--font-en); direction: ltr; }
        
        .viewer-wrap { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        model-viewer { width: 100%; height: 100%; background: radial-gradient(circle at 50% 50%, #f5f6fa 0%, #dcdde1 100%); --poster-color: transparent; touch-action: none; }
        
        .loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; border: 5px solid #ddd; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; display: none; z-index: 5; }
        @keyframes spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }
        
        .lang-btn { position: absolute; top: max(20px, env(safe-area-inset-top)); right: 20px; z-index: 100; background: rgba(255,255,255,0.8); padding: 8px 12px; border-radius: 12px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        body.lang-en .lang-btn { right: auto; left: 20px; }
        
        .panel { position: absolute; bottom: 0; left: 0; width: 100%; z-index: 20; background: var(--surface); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); padding: 20px; padding-bottom: max(20px, env(safe-area-inset-bottom)); border-radius: 24px 24px 0 0; box-shadow: 0 -10px 40px rgba(0,0,0,0.15); }
        @media (min-width: 768px) { .panel { width: 400px; left: 50%; bottom: 20px; transform: translateX(-50%); border-radius: 24px; } }
        
        .tabs { display: flex; gap: 8px; background: rgba(0,0,0,0.06); padding: 5px; border-radius: 14px; margin-bottom: 15px; }
        .tab { flex: 1; padding: 10px; border: none; background: transparent; border-radius: 10px; font-family: inherit; font-size: 0.95rem; color: #636e72; cursor: pointer; transition: 0.2s; }
        .tab.active { background: #fff; color: #2d3436; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        
        .info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .info h3 { margin: 0; font-size: 1.1rem; }
        
        .list { display: flex; gap: 12px; overflow-x: auto; padding: 4px; scrollbar-width: none; min-height: 85px; }
        .list::-webkit-scrollbar { display: none; }
        .item { flex: 0 0 auto; width: 75px; height: 75px; background: #fff; border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 2rem; border: 2px solid transparent; transition: 0.2s; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .item.active { border-color: var(--primary); background: #e0f2f1; transform: translateY(-3px); }
        
        .size-ctrl { margin-top: 15px; background: rgba(0,0,0,0.04); padding: 12px; border-radius: 12px; display: flex; align-items: center; gap: 10px; }
        .size-lbl { font-size: 0.85rem; font-weight: bold; white-space: nowrap; width: 90px; }
        input[type=range] { width: 100%; accent-color: var(--primary); }
        
        .ar-btn { width: 100%; margin-top: 15px; padding: 16px; border: none; border-radius: 16px; background: linear-gradient(135deg, #00b894, #00cec9); color: white; font-family: inherit; font-weight: 800; font-size: 1rem; cursor: pointer; box-shadow: 0 8px 25px rgba(0, 184, 148, 0.4); display: flex; justify-content: center; gap: 8px; }
        .ar-btn:active { transform: scale(0.98); }
        
        .colors { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .color { width: 30px; height: 30px; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 3px 8px rgba(0,0,0,0.2); cursor: pointer; }
        button[slot="ar-button"] { display: none; }
    </style>
</head>
<body>
    <div class="lang-btn" onclick="toggleLang()">EN / FA</div>
    <div class="loader" id="loader"></div>
    
    <div class="viewer-wrap">
        <model-viewer 
            id="viewer" 
            src="./pot1.glb" 
            ar 
            ar-modes="webxr quick-look scene-viewer" 
            ar-scale="auto" 
            camera-controls 
            shadow-intensity="1" 
            shadow-softness="0.5" 
            loading="eager" 
            auto-rotate>
        </model-viewer>
    </div>

    <div class="panel">
        <div class="tabs">
            <button class="tab active" onclick="setCat('pots')" id="t-pots">ğŸº Ú¯Ù„Ø¯Ø§Ù†</button>
            <button class="tab" onclick="setCat('carpets')" id="t-carpets">ğŸ§¶ ÙØ±Ø´</button>
        </div>
        
        <div class="info">
            <h3 id="txt-title">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¯Ù„</h3>
            <span id="txt-sub">5 items</span>
        </div>
        
        <div class="list" id="list"></div>
        
        <div class="size-ctrl">
            <span class="size-lbl" id="txt-size">Ø³Ø§ÛŒØ²: 1</span>
            <input type="range" min="0.0001" max="0.05" step="0.0001" value="0.0005" id="slider" oninput="onSizeChange(this.value)">
        </div>
        
        <div class="colors" id="colors">
            <div class="color" style="background:#fff" onclick="setColor('#ffffff')"></div>
            <div class="color" style="background:#2d3436" onclick="setColor('#2d3436')"></div>
            <div class="color" style="background:#e84393" onclick="setColor('#e84393')"></div>
            <div class="color" style="background:#fdcb6e" onclick="setColor('#fdcb6e')"></div>
        </div>
        
        <button class="ar-btn" onclick="startAR()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
            <span id="txt-btn">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ù…Ø­ÛŒØ·</span>
        </button>
    </div>

    <script>
        const viewer = document.getElementById('viewer');
        const list = document.getElementById('list');
        const slider = document.getElementById('slider');
        const sizeLbl = document.getElementById('txt-size');
        const loader = document.getElementById('loader');
        
        let cat = 'pots';
        let lang = 'fa';
        
        // Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        const db = {
            pots: {
                shadow: 1,
                placement: 'auto',
                // Ú¯Ù„Ø¯Ø§Ù†â€ŒÙ‡Ø§ Ù…Ø¹Ù…ÙˆÙ„Ø§ Ø³Ø§ÛŒØ² Ù†Ø±Ù…Ø§Ù„ Ø¯Ø§Ø±Ù†Ø¯ (Ø¶Ø±ÛŒØ¨ 1)
                defaultScale: 1,
                sliderMin: 0.1,
                sliderMax: 2,
                items: [
                    { n_fa:"Ú¯Ù„Ø¯Ø§Ù† Û±", n_en:"Pot 1", src:"./pot1.glb", icon:"ğŸª´" },
                    { n_fa:"Ú¯Ù„Ø¯Ø§Ù† Û²", n_en:"Pot 2", src:"./pot2.glb", icon:"ğŸŒµ" },
                    { n_fa:"Ú¯Ù„Ø¯Ø§Ù† Û³", n_en:"Pot 3", src:"./pot3.glb", icon:"ğŸº" },
                    { n_fa:"Ú¯Ù„Ø¯Ø§Ù† Û´", n_en:"Pot 4", src:"./pot4.glb", icon:"ğŸŒ»" },
                    { n_fa:"Ú¯Ù„Ø¯Ø§Ù† Ûµ", n_en:"Pot 5", src:"./pot5.glb", icon:"ğŸ" }
                ]
            },
            carpets: {
                shadow: 0,
                placement: 'floor',
                // ğŸ”¥ Ø´Ø±ÙˆØ¹ Ù…ÛŒÚ©Ø±ÙˆØ³Ú©ÙˆÙ¾ÛŒ: 0.0005
                // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§ 300 Ù…ØªØ± Ø¨ÙˆØ¯ØŒ Ø§Ù„Ø§Ù† Ù…ÛŒØ´Ù‡ 15 Ø³Ø§Ù†ØªÛŒÙ…ØªØ± (Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú©)
                defaultScale: 0.0005,
                // Ø¯Ø§Ù…Ù†Ù‡ Ø§Ø³Ù„Ø§ÛŒØ¯Ø± Ø¨Ø±Ø§ÛŒ ÙØ±Ø´: ÙÙ‚Ø· ØªØ§ 5 Ø¯Ø±ØµØ¯ Ø¨Ø²Ø±Ú¯ Ø´ÙˆØ¯
                sliderMin: 0.0001,
                sliderMax: 0.05,
                items: [
                    { n_fa:"ÙØ±Ø´ Û±", n_en:"Rug 1", src:"./carpet1.glb", icon:"ğŸ§¶" },
                    { n_fa:"ÙØ±Ø´ Û²", n_en:"Rug 2", src:"./carpet2.glb", icon:"ğŸ¦" },
                    { n_fa:"ÙØ±Ø´ Û³", n_en:"Rug 3", src:"./carpet3.glb", icon:"ğŸ¨" },
                    { n_fa:"ÙØ±Ø´ Û´", n_en:"Rug 4", src:"./carpet4.glb", icon:"ğŸ’ " },
                    { n_fa:"ÙØ±Ø´ Ûµ", n_en:"Rug 5", src:"./carpet5.glb", icon:"ğŸŒ·" }
                ]
            }
        };

        const txt = { fa: { t_p:"Ú¯Ù„Ø¯Ø§Ù†", t_c:"ÙØ±Ø´", h:"Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¯Ù„", sz:"Ø¶Ø±ÛŒØ¨ Ø³Ø§ÛŒØ²:", b:"Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ù…Ø­ÛŒØ·" }, en: { t_p:"Pots", t_c:"Carpets", h:"Select Model", sz:"Scale Factor:", b:"View in AR" } };

        function init() {
            setCat('pots');
            viewer.addEventListener('load', () => loader.style.display = 'none');
            viewer.addEventListener('progress', () => loader.style.display = 'block');
        }

        function setCat(c) {
            cat = c;
            // Ø¢Ù¾Ø¯ÛŒØª Ø¸Ø§Ù‡Ø± ØªØ¨â€ŒÙ‡Ø§
            document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
            document.getElementById(c === 'pots' ? 't-pots' : 't-carpets').classList.add('active');
            document.getElementById('colors').style.display = c === 'pots' ? 'flex' : 'none';
            
            // ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬Ø¯Ø¯ Ø±Ù†Ø¬ Ø§Ø³Ù„Ø§ÛŒØ¯Ø± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡ Ø¨Ù†Ø¯ÛŒ
            const config = db[c];
            slider.min = config.sliderMin;
            slider.max = config.sliderMax;
            slider.step = c === 'carpets' ? 0.0001 : 0.1;

            renderList();
        }

        function renderList() {
            list.innerHTML = '';
            const config = db[cat];
            config.items.forEach((item, idx) => {
                const el = document.createElement('div');
                el.className = `item ${idx===0 && !viewer.src ? 'active' : ''}`;
                if(viewer.src && viewer.src.includes(item.src.replace('./',''))) el.classList.add('active');
                el.innerHTML = item.icon;
                el.onclick = () => loadItem(item, el, config);
                list.appendChild(el);
                if(idx === 0 && !viewer.src) loadItem(item, el, config);
            });
        }

        function loadItem(item, el, config) {
            loader.style.display = 'block';
            document.querySelectorAll('.item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            
            viewer.src = item.src;
            viewer.shadowIntensity = config.shadow;
            viewer.setAttribute('ar-placement', config.placement);
            
            // Ø§Ø¹Ù…Ø§Ù„ Ø³Ø§ÛŒØ² Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ù…ÛŒÚ©Ø±ÙˆØ³Ú©ÙˆÙ¾ÛŒ Ø¨Ø±Ø§ÛŒ ÙØ±Ø´)
            const s = config.defaultScale;
            applyScale(s);
            slider.value = s;
        }

        function onSizeChange(val) {
            applyScale(val);
        }
        
        function applyScale(val) {
            viewer.scale = `${val} ${val} ${val}`;
            // Ù†Ù…Ø§ÛŒØ´ Ø¹Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯ Ø¨Ù‡ØªØ±
            sizeLbl.innerText = lang === 'fa' ? `Ø³Ø§ÛŒØ²: ${val}` : `Scale: ${val}`;
        }

        function setColor(hex) {
            if(!viewer.model) return;
            const mat = viewer.model.materials[0];
            if(mat) mat.pbrMetallicRoughness.setBaseColorFactor(hexToRgb(hex));
        }

        function startAR() {
            if(viewer.canActivateAR) viewer.activateAR();
            else alert(lang==='fa' ? 'Ø¯Ø³ØªÚ¯Ø§Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯' : 'Device not supported');
        }

        function toggleLang() {
            lang = lang === 'fa' ? 'en' : 'fa';
            document.body.className = lang === 'en' ? 'lang-en' : '';
            const t = txt[lang];
            document.getElementById('t-pots').innerText = t.t_p;
            document.getElementById('t-carpets').innerText = t.t_c;
            document.getElementById('txt-title').innerText = t.h;
            document.getElementById('txt-btn').innerText = t.b;
            // Ø±ÙØ±Ø´ Ú©Ø±Ø¯Ù† ØªÚ©Ø³Øª Ø§Ø³Ù„Ø§ÛŒØ¯Ø±
            applyScale(slider.value);
        }

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;
            return [r, g, b, 1];
        }

        init();
    </script>
</body>
</html>