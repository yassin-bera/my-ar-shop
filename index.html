<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AR Gallery</title>
    
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>

    <style>
        :root {
            --primary: #00b894;
            --surface: rgba(255, 255, 255, 0.92);
            --blur: blur(20px);
            --text: #2d3436;
            --font-fa: 'Vazirmatn', sans-serif;
            --font-en: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            margin: 0;
            height: 100dvh;
            width: 100vw;
            overflow: hidden;
            font-family: var(--font-fa);
            background-color: #dfe6e9;
            transition: all 0.3s ease;
        }

        body.lang-en {
            font-family: var(--font-en);
            direction: ltr;
        }

        .viewer-container {
            width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1;
        }

        model-viewer {
            width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 30%, #fff 0%, #b2bec3 100%);
            --poster-color: transparent;
            
            /* ğŸ”¥ Ù†Ú©ØªÙ‡ Ú©Ù„ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ù„ Ù…Ø´Ú©Ù„ Ø²ÙˆÙ…: */
            touch-action: none; 
        }

        /* Ø¯Ú©Ù…Ù‡ ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù† */
        .lang-switch {
            position: absolute;
            top: calc(20px + env(safe-area-inset-top));
            right: 20px;
            z-index: 50;
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(4px);
            padding: 8px 12px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        body.lang-en .lang-switch { right: auto; left: 20px; }
        .lang-switch:active { transform: scale(0.95); }

        /* Ù¾Ù†Ù„ Ú©Ù†ØªØ±Ù„ */
        .control-panel {
            position: absolute; bottom: 0; left: 0; width: 100%; z-index: 20;
            background: var(--surface);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            padding: 20px;
            padding-bottom: max(20px, env(safe-area-inset-bottom));
            border-top-left-radius: 24px; border-top-right-radius: 24px;
            box-shadow: 0 -5px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        @media (min-width: 768px) {
            .control-panel {
                width: 400px; left: 50%; bottom: 20px;
                transform: translateX(-50%); border-radius: 24px;
            }
        }

        .category-tabs {
            display: flex; gap: 10px;
            background: rgba(0,0,0,0.05);
            padding: 4px; border-radius: 12px;
            margin-bottom: 15px;
        }

        .tab-btn {
            flex: 1; border: none; background: transparent;
            padding: 8px; border-radius: 10px;
            font-family: inherit; font-size: 0.9rem;
            color: #636e72; cursor: pointer; transition: all 0.2s;
        }

        .tab-btn.active {
            background: #fff; color: var(--text);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-weight: bold;
        }

        .header-row {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
        }

        h2 { margin: 0; font-size: 1rem; color: var(--text); }
        .subtitle { font-size: 0.8rem; color: #aaa; }

        .pot-list {
            display: flex; gap: 12px; overflow-x: auto; padding: 4px;
            scrollbar-width: none; min-height: 80px;
        }
        .pot-list::-webkit-scrollbar { display: none; }

        .item-box {
            flex: 0 0 auto; width: 70px; height: 70px;
            border-radius: 18px; background: #fff;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .item-box.active {
            border-color: var(--primary); background: #e0f2f1;
            transform: scale(1.1);
        }

        .color-picker {
            display: flex; justify-content: center; gap: 15px; margin-top: 15px;
        }
        .color-dot {
            width: 28px; height: 28px; border-radius: 50%;
            border: 2px solid #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            cursor: pointer;
        }

        .ar-btn {
            width: 100%; margin-top: 15px; padding: 14px;
            background: var(--primary); color: white; border: none;
            border-radius: 16px; font-family: inherit; font-weight: bold;
            font-size: 1rem; display: flex; align-items: center; justify-content: center;
            gap: 8px; box-shadow: 0 8px 20px rgba(0, 184, 148, 0.3); cursor: pointer;
        }
        
        button[slot="ar-button"] { display: none; }
    </style>
</head>
<body>

    <div class="lang-switch" onclick="toggleLanguage()">EN / FA</div>

    <div class="viewer-container">
        <model-viewer 
            id="viewer"
            src="./pot1.glb" 
            ar
            ar-modes="scene-viewer webxr quick-look"
            ar-scale="auto"
            camera-controls
            shadow-intensity="1"
            shadow-softness="0.8"
            auto-rotate>
        </model-viewer>
    </div>

    <div class="control-panel">
        <div class="category-tabs">
            <button class="tab-btn active" onclick="switchCategory('pots')" id="tab-pots">ğŸº Ú¯Ù„Ø¯Ø§Ù†</button>
            <button class="tab-btn" onclick="switchCategory('carpets')" id="tab-carpets">ğŸ§¶ ÙØ±Ø´</button>
        </div>

        <div class="header-row">
            <h2 id="txt-title">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¯Ù„</h2>
            <span class="subtitle" id="txt-subtitle">Ûµ Ù…Ø¯Ù„</span>
        </div>

        <div class="pot-list" id="itemList"></div>

        <div class="color-picker" id="colorPickerPanel">
            <div class="color-dot" style="background: #ffffff" onclick="changeColor('#ffffff')"></div>
            <div class="color-dot" style="background: #34495e" onclick="changeColor('#34495e')"></div>
            <div class="color-dot" style="background: #e74c3c" onclick="changeColor('#e74c3c')"></div>
            <div class="color-dot" style="background: #f1c40f" onclick="changeColor('#f1c40f')"></div>
            <div class="color-dot" style="background: #9b59b6" onclick="changeColor('#9b59b6')"></div>
        </div>

        <button class="ar-btn" onclick="activateARMode()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M13 3l6 6-6 6M5 3l-6 6 6 6M3 21h18"/>
            </svg>
            <span id="txt-btn">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒ</span>
        </button>
    </div>

    <script>
        const viewer = document.getElementById('viewer');
        const itemList = document.getElementById('itemList');
        const colorPanel = document.getElementById('colorPickerPanel');
        
        let currentCategory = 'pots';
        let currentLang = 'fa';

        const translations = {
            fa: {
                tabPots: "ğŸº Ú¯Ù„Ø¯Ø§Ù†",
                tabCarpets: "ğŸ§¶ ÙØ±Ø´",
                title: "Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¯Ù„",
                subtitle: "Ù…Ø¯Ù„ Ù…ÙˆØ¬ÙˆØ¯",
                btn: "Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒ",
                alert: "Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø´Ù…Ø§ Ø§Ø² AR Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯"
            },
            en: {
                tabPots: "ğŸº Pots",
                tabCarpets: "ğŸ§¶ Carpets",
                title: "Select Model",
                subtitle: "Models Available",
                btn: "View in your space",
                alert: "Your device does not support AR"
            }
        };

        const db = {
            pots: [
                { name_fa: "Ú¯Ù„Ø¯Ø§Ù† Û±", name_en: "Pot 1", src: "./pot1.glb", icon: "ğŸ" },
                { name_fa: "Ú¯Ù„Ø¯Ø§Ù† Û²", name_en: "Pot 2", src: "./pot2.glb", icon: "ğŸŒ¹" },
                { name_fa: "Ú¯Ù„Ø¯Ø§Ù† Û³", name_en: "Pot 3", src: "./pot3.glb", icon: "ğŸº" },
                { name_fa: "Ú¯Ù„Ø¯Ø§Ù† Û´", name_en: "Pot 4", src: "./pot4.glb", icon: "ğŸ" },
                { name_fa: "Ú¯Ù„Ø¯Ø§Ù† Ûµ", name_en: "Pot 5", src: "./pot5.glb", icon: "â›©ï¸" }
            ],
            carpets: [
                { name_fa: "ÙØ±Ø´ Û±", name_en: "Carpet 1", src: "./carpet1.glb", icon: "ğŸ§¶" },
                { name_fa: "ÙØ±Ø´ Û²", name_en: "Carpet 2", src: "./carpet2.glb", icon: "ğŸ¦" },
                { name_fa: "ÙØ±Ø´ Û³", name_en: "Carpet 3", src: "./carpet3.glb", icon: "ğŸ¨" },
                { name_fa: "ÙØ±Ø´ Û´", name_en: "Carpet 4", src: "./carpet4.glb", icon: "ğŸ’ " },
                { name_fa: "ÙØ±Ø´ Ûµ", name_en: "Carpet 5", src: "./carpet5.glb", icon: "ğŸŒ·" }
            ]
        };

        function toggleLanguage() {
            currentLang = currentLang === 'fa' ? 'en' : 'fa';
            updateUIText();
            renderList();
            
            if (currentLang === 'en') {
                document.body.classList.add('lang-en');
                document.documentElement.setAttribute('dir', 'ltr');
            } else {
                document.body.classList.remove('lang-en');
                document.documentElement.setAttribute('dir', 'rtl');
            }
        }

        function updateUIText() {
            const t = translations[currentLang];
            document.getElementById('tab-pots').innerText = t.tabPots;
            document.getElementById('tab-carpets').innerText = t.tabCarpets;
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-btn').innerText = t.btn;
            
            const count = db[currentCategory].length;
            document.getElementById('txt-subtitle').innerText = `${count} ${t.subtitle}`;
        }

        function switchCategory(cat) {
            currentCategory = cat;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${cat}`).classList.add('active');
            renderList();
            updateUIText();
        }

        function renderList() {
            itemList.innerHTML = '';
            const data = db[currentCategory];

            data.forEach((item, index) => {
                const btn = document.createElement('div');
                const isActive = viewer.src.includes(item.src.replace('./',''));
                btn.className = `item-box ${isActive ? 'active' : ''}`;
                if (index === 0 && !viewer.src) btn.classList.add('active');

                btn.innerHTML = item.icon;
                
                btn.onclick = () => {
                    loadModel(item.src);
                    document.querySelectorAll('.item-box').forEach(i => i.classList.remove('active'));
                    btn.classList.add('active');
                };
                itemList.appendChild(btn);
            });
        }

        function loadModel(src) {
            viewer.src = src;
        }

        function changeColor(hex) {
            if (!viewer.model) return;
            const mat = viewer.model.materials[0];
            if(mat) mat.pbrMetallicRoughness.setBaseColorFactor(hexToRgb(hex));
        }

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;
            return [r, g, b, 1];
        }

        function activateARMode() {
            if (viewer.canActivateAR) {
                viewer.activateAR();
            } else {
                alert(translations[currentLang].alert);
            }
        }

        renderList();
    </script>
</body>
</html>